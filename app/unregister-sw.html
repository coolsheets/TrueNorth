<!DOCTYPE html>
<html>
<head>
    <title>Unregister Service Workers</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans', Arial, sans-serif; padding: 20px; line-height: 1.6; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow: auto; }
        .container { max-width: 800px; margin: 0 auto; }
        button { padding: 10px 15px; background: #0ea5e9; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0c8ac5; }
        #result { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Service Worker Cleanup Tool</h1>
        <p>This tool will:</p>
        <ul>
            <li>Unregister all service workers</li>
            <li>Clear caches related to the PWA</li>
            <li>Clear IndexedDB data (if possible)</li>
        </ul>
        
        <button id="unregisterBtn">Unregister All Service Workers</button>
        <button id="clearCacheBtn">Clear Caches</button>
        <button id="clearAllBtn">Do Everything</button>
        
        <div id="result"></div>
        
        <script>
            const resultDiv = document.getElementById('result');
            
            async function unregisterServiceWorkers() {
                try {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    let result = `Found ${registrations.length} service worker(s)\n`;
                    
                    for (let registration of registrations) {
                        result += `Unregistering service worker for: ${registration.scope}\n`;
                        await registration.unregister();
                    }
                    
                    result += "âœ… All service workers unregistered successfully";
                    return result;
                } catch (error) {
                    return `âŒ Error unregistering service workers: ${error.message}`;
                }
            }
            
            async function clearCaches() {
                try {
                    const cacheNames = await caches.keys();
                    let result = `Found ${cacheNames.length} cache(s)\n`;
                    
                    for (let cacheName of cacheNames) {
                        result += `Deleting cache: ${cacheName}\n`;
                        await caches.delete(cacheName);
                    }
                    
                    result += "âœ… All caches cleared successfully";
                    return result;
                } catch (error) {
                    return `âŒ Error clearing caches: ${error.message}`;
                }
            }
            
            async function clearIndexedDB() {
                try {
                    // Get all database names
                    const databases = await indexedDB.databases();
                    let result = `Found ${databases.length} IndexedDB database(s)\n`;
                    
                    for (let db of databases) {
                        result += `Attempting to delete database: ${db.name}\n`;
                        await indexedDB.deleteDatabase(db.name);
                    }
                    
                    result += "âœ… IndexedDB cleanup attempted";
                    return result;
                } catch (error) {
                    return `âš ï¸ IndexedDB cleanup may be incomplete: ${error.message}`;
                }
            }
            
            document.getElementById('unregisterBtn').addEventListener('click', async () => {
                resultDiv.innerHTML = '<pre>Working...</pre>';
                const result = await unregisterServiceWorkers();
                resultDiv.innerHTML = `<pre>${result}</pre>`;
            });
            
            document.getElementById('clearCacheBtn').addEventListener('click', async () => {
                resultDiv.innerHTML = '<pre>Working...</pre>';
                const result = await clearCaches();
                resultDiv.innerHTML = `<pre>${result}</pre>`;
            });
            
            document.getElementById('clearAllBtn').addEventListener('click', async () => {
                resultDiv.innerHTML = '<pre>Working...</pre>';
                let result = '';
                
                result += await unregisterServiceWorkers();
                result += '\n\n';
                result += await clearCaches();
                result += '\n\n';
                result += await clearIndexedDB();
                
                resultDiv.innerHTML = `<pre>${result}</pre>`;
                
                result += '\n\nðŸ”„ Page will reload in 3 seconds...';
                resultDiv.innerHTML = `<pre>${result}</pre>`;
                
                setTimeout(() => {
                    window.location.reload();
                }, 3000);
            });
        </script>
    </div>
</body>
</html>
